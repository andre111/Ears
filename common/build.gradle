apply plugin: 'java-library'

sourceCompatibility = JavaVersion.VERSION_21
targetCompatibility = JavaVersion.VERSION_21

repositories {
	maven { url 'https://repo1.maven.org/maven2/' }
	maven { url 'https://libraries.minecraft.net/' }
	maven { url 'https://repo.spongepowered.org/maven/' }
	maven { url 'https://teavm.org/maven/repository/' }
}
sourceSets {
	api {
		compileClasspath += sourceSets.main.compileClasspath
	}
	normal {
		compileClasspath += sourceSets.api.output
		compileClasspath += sourceSets.api.compileClasspath
	}
	main {
		compileClasspath += sourceSets.normal.output
		compileClasspath += sourceSets.normal.compileClasspath
		runtimeClasspath += sourceSets.normal.output
		runtimeClasspath += sourceSets.normal.runtimeClasspath
	}
	mixin {
		compileClasspath += sourceSets.main.output
		compileClasspath += sourceSets.main.compileClasspath
		runtimeClasspath += sourceSets.main.output
		runtimeClasspath += sourceSets.main.runtimeClasspath
	}
	modern {
		compileClasspath += sourceSets.main.output
		compileClasspath += sourceSets.main.compileClasspath
		runtimeClasspath += sourceSets.main.output
		runtimeClasspath += sourceSets.main.runtimeClasspath
	}
}

jar {
	from sourceSets.normal.output
	from sourceSets.main.output

	archiveClassifier = ''
	
	duplicatesStrategy = DuplicatesStrategy.INCLUDE
}

task apiJar(type: Jar) {
	from sourceSets.api.output
	
	baseName 'ears'
	archiveClassifier = 'api'
	
	duplicatesStrategy = DuplicatesStrategy.INCLUDE
}

task apiSourcesJar(type: Jar) {
	from sourceSets.api.allSource
	
	baseName 'ears'
	archiveClassifier = 'api-sources'
	
	duplicatesStrategy = DuplicatesStrategy.INCLUDE
}

task mixinModernJar(type: Jar) {
	from sourceSets.api.output
	from sourceSets.main.output
	from sourceSets.normal.output
	from sourceSets.mixin.output
	from sourceSets.modern.output
	
	archiveClassifier = 'mixin-modern'
	
	duplicatesStrategy = DuplicatesStrategy.INCLUDE
}

task modernJar(type: Jar) {
	from sourceSets.api.output
	from sourceSets.main.output
	from sourceSets.normal.output
	from sourceSets.modern.output
	
	archiveClassifier = 'modern'
	
	duplicatesStrategy = DuplicatesStrategy.INCLUDE
}

build.dependsOn apiJar
build.dependsOn apiSourcesJar
build.dependsOn mixinModernJar
build.dependsOn modernJar

dependencies {
	implementation('org.spongepowered:mixin:0.7-SNAPSHOT') {
		transitive = false
	}
	
	implementation 'org.ow2.asm:asm:9.2'
	implementation 'org.ow2.asm:asm-tree:9.2'
}
